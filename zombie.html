
<html>
  <head>
    <title>Where's Zombie?</title>
      <meta name="description" content="Zombie map within Whangamata">
      <meta name="keywords" content="Zombie, Whangamata, map">
      <meta name="author" content="Ian Fulton">
      
      <style>
#zombie_map {
    height: 100%;
    width: 100%;
    left: 0;
    position: absolute;
    top: 0;  
    background-color: grey;
}
</style>
  </head>
    
  <body style="background-color:#9BDCB7;">
    <div id="zombie_map"></div>
      
      <form>
      <!--Select an emoji-->
        <select id="icon_to_use">
            <option value="zombie.png">Zombie</option>
            <option value="weapons.png">Weapons</option>
            <option value="hospital.png">Hospital</option>
        </select>
      </form>
      
    
    <script>
    var zombie_map;
    var score;
    var tolerance = 10;
    var old_position;
    var all_markers = [];
    var data = `51.1566191056614 2.9703928173578333 zombie.png
		51.1567604156709 2.970929259160812 zombie.png
		51.15646097251856 2.9710365475214075 zombie.png
		51.15638695256336 2.970623487333114 weapons.png
		51.15687144466047 2.9705698431528162 weapons.png
		51.15689836073894 2.9718090237176966 weapons.png
		51.15638022347064 2.9718304813898157 hospital.png
		51.15702284739748 2.971025818685348 hospital.png
		51.156592735772016 2.972580049921362 zombie.png
		51.15673068134137 2.9719685062659664 zombie.png
		51.15665666181886 2.971582268167822 zombie.png
		51.15635721799313 2.972252820421545 zombie.png
		51.1561620737799 2.971753929544775 zombie.png
		51.15595347043234 2.971930955339758 weapons.png
		51.15603791004488 2.970583967847233 zombie.png`;
    var markers = data.split("\n");
    
    function initMap() {
        zombie_map = new google.maps.Map(document.getElementById('zombie_map'), {zoom: 16,center: {lat: 51.157086, lng: 2.971126}
        });    
        
        old_position = new google.maps.Marker({
        position: {lat: -37.218, lng: 175.867046},
        map: zombie_map,
        });
        
        for (var i = 0; i < markers.length; i++) {
            var marker_data = markers[i].trim();
            marker_data = marker_data.split(" ");
            var latitude = marker_data[0];
            var longitude = marker_data[1];
            var emoji = marker_data[2];
            var marker_position = new google.maps.LatLng(latitude, longitude);
            var marker = new google.maps.Marker({
                position: marker_position,
                map: zombie_map,
                icon: emoji
            });
            all_markers.push(marker);
        }
       
        if(navigator.geolocation) {
    navigator.geolocation.watchPosition(set_my_position);
}
else {
    alert("Geolocation doesn't work in your browser");
}
       }   
    
    function set_my_position(position){
        old_position.setMap(null);
        
        var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
        var marker = new google.maps.Marker({
                position: pos,
                map: zombie_map
            });
        
        old_position = marker;
        for (var i = 0; i < all_markers.length; i++) {
            var distance = google.maps.geometry.spherical.computeDistanceBetween(pos, all_markers[i].getPosition());
        if(distance < tolerance){
            var what_is_it = all_markers[i].getIcon();
            what_is_it = what_is_it.replace(".png", "hospital");
            alert("Found the " + what_is_it );
            all_markers[i].setMap(null);
          }
    }
          
    }
    </script>
      
      <script async defer
              src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA5UEuZfXqPaFRYiSdyfFmBg7LklTXUnTA&callback=initMap&libraries=geometry">
      </script>    
  </body>
</html>
